import e,{useRef as t,useEffect as n,useCallback as r,useMemo as o}from"react";function i(e){if(!e)return[];const t=[];return Array.from(e.childNodes).forEach((e=>{var n;3===e.nodeType?t.push((null===(n=e.textContent)||void 0===n?void 0:n.trim())||""):t.push(...i(e))})),t}const l=(e,t="")=>e?i(e).join("\n"):t,c=e=>e.replace(/\s+$/,""),u=i=>{var{children:u,ellipsis:s="...",lines:a=1,trimWhitespace:f=!1,onTruncate:p,width:d}=i,h=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(i,["children","ellipsis","lines","trimWhitespace","onTruncate","width"]);const m=t(null),v=t(null),y=t(null),w=t(null),g=t(null),[E,b]=function(t){const n=e.useRef(null),[r,o]=e.useState(t);e.useEffect((()=>{n.current&&(n.current(r),n.current=null)}),[r]);const i=e.useCallback(((e,t)=>(n.current=t||null,o(e))),[]);return[r,i]}(0);n((()=>{const e=document.createElement("canvas");g.current=e.getContext("2d");const t=y.current;return()=>{var e;w.current&&cancelAnimationFrame(w.current),t&&(null===(e=t.parentNode)||void 0===e||e.removeChild(t))}}),[]);const j=r((e=>{var t;if(!m.current)return;let n=d;if(n||(n=m.current.parentNode instanceof HTMLElement?Math.floor(null===(t=m.current.parentNode)||void 0===t?void 0:t.getBoundingClientRect().width):0),!n)return window.requestAnimationFrame((()=>j(e)));const r=window.getComputedStyle(m.current),o=[r.fontWeight,r.fontStyle,r.fontSize,r.fontFamily].join(" ");g.current&&(g.current.font=o),b(n,e)}),[b,d]);n((()=>{const e=()=>{j()};return j((()=>{var e;v.current&&(null===(e=v.current.parentNode)||void 0===e||e.removeChild(v.current))})),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[d,j]);const O=r((e=>{"function"==typeof p&&(w.current=window.requestAnimationFrame((()=>{p(e)})))}),[p]),x=r(((t,n,r)=>{if(n===r.length-1)return e.createElement("span",{key:n},t,n===a-1&&s);{const r=e.createElement("br",{key:n+"br"});return t?[e.createElement("span",{key:n},t),r]:r}}),[s,a]),C=e=>{var t;return(null===(t=g.current)||void 0===t?void 0:t.measureText(e).width)||0},S=o((()=>{if(!!(!m.current||!E))return null;return a>0?(()=>{var e;const t=[],n=l(v.current).split("\n").map((e=>e.split(" ")));let r=!0;const o=(null===(e=y.current)||void 0===e?void 0:e.offsetWidth)||0;for(let e=1;e<=a;e++){const i=n[0];if(0===i.length){t.push(),n.shift(),e--;continue}let l=i.join(" ");if(C(l)<=E&&1===n.length){r=!1,t.push(l);break}if(e===a){const e=i.join(" ");let n=0,r=e.length-1;for(;n<=r;){const t=Math.floor((n+r)/2),i=e.slice(0,t+1);C(i)+o<=E?n=t+1:r=t-1}let l=e.slice(0,n);if(f)for(l=c(l);!l.length&&t.length;){const e=t.pop();l=c(e||"")}t.push(l)}else{let r=0,o=i.length-1;for(;r<=o;){const e=Math.floor((r+o)/2),t=i.slice(0,e+1).join(" ");C(t)<=E?r=e+1:o=e-1}if(0===r){e=a-1;continue}l=i.slice(0,r).join(" "),n[0].splice(0,r),t.push(l)}}return O(r),t})().map(x):u}),[u,O,a,x,E,f]);return e.createElement("span",Object.assign({},h),e.createElement("span",{ref:m},S),e.createElement("span",{ref:v},u),e.createElement("span",{ref:y,style:{position:"fixed",visibility:"hidden",top:0,left:0}},s))};export{u as default};
//# sourceMappingURL=index.js.map
