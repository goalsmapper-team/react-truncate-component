import e,{useRef as n,useEffect as t,useCallback as r,useMemo as o}from"react";const i=e=>e.replace(/\s+$/,""),l=l=>{var{children:c,ellipsis:u="...",lines:s=1,trimWhitespace:a=!1,onTruncate:f,width:p}=l,d=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(t[r[o]]=e[r[o]])}return t}(l,["children","ellipsis","lines","trimWhitespace","onTruncate","width"]);const m=n(null),h=n(null),v=n(null),g=n(null),y=n(null),[b,w]=function(n){const t=e.useRef(null),[r,o]=e.useState(n);e.useEffect((()=>{t.current&&(t.current(r),t.current=null)}),[r]);const i=e.useCallback(((e,n)=>(t.current=n||null,o(e))),[]);return[r,i]}(0);t((()=>{const e=document.createElement("canvas");y.current=e.getContext("2d");const n=v.current;return()=>{var e;g.current&&cancelAnimationFrame(g.current),n&&(null===(e=n.parentNode)||void 0===e||e.removeChild(n))}}),[]);const E=r((e=>{var n;if(!m.current)return;let t=p;if(t||(t=m.current.parentNode instanceof HTMLElement?Math.floor(null===(n=m.current.parentNode)||void 0===n?void 0:n.getBoundingClientRect().width):0),!t)return window.requestAnimationFrame((()=>E(e)));const r=window.getComputedStyle(m.current),o=[r.fontWeight,r.fontStyle,r.fontSize,r.fontFamily].join(" ");y.current&&(y.current.font=o),w(t,e)}),[w,p]);t((()=>{const e=()=>{E()};return E((()=>{var e;h.current&&(null===(e=h.current.parentNode)||void 0===e||e.removeChild(h.current))})),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[p,E]);const T=r((e=>{"function"==typeof f&&(g.current=window.requestAnimationFrame((()=>{f(e)})))}),[f]),j=r(((n,t,r)=>{if(t===r.length-1)return e.createElement("span",{key:t},n,u);{const r=e.createElement("br",{key:t+"br"});return n?[e.createElement("span",{key:t},n),r]:r}}),[u]),O=e=>{var n;return(null===(n=y.current)||void 0===n?void 0:n.measureText(e).width)||0},x=o((()=>{if(!!(!m.current||!b))return null;const e=()=>{var e;const n=[],t=((e,n="")=>{var t;if(!e)return n;const r=document.createElement("div"),o="innerText"in e?"innerText":"textContent";r.innerHTML=e.innerHTML.replace(/\r\n|\r|\n/g," ");let i=r[o];const l=document.createElement("div");return l.innerHTML="foo<br/>bar","foo\nbar"!==(null===(t=l[o])||void 0===t?void 0:t.replace(/\r\n|\r/g,"\n"))&&(r.innerHTML=r.innerHTML.replace(/<br.*?[\/]?>/gi,"\n"),i=r[o]),i||n})(h.current),r=t.split("\n").map((e=>e.split(" ")));let o=!0;const l=(null===(e=v.current)||void 0===e?void 0:e.offsetWidth)||0;for(let e=1;e<=s;e++){const t=r[0];if(0===t.length){n.push(),r.shift(),e--;continue}let c=t.join(" ");if(O(c)<=b&&1===r.length){o=!1,n.push(c);break}if(e===s){const e=t.join(" ");let r=0,o=e.length-1;for(;r<=o;){const n=Math.floor((r+o)/2),t=e.slice(0,n+1);O(t)+l<=b?r=n+1:o=n-1}let c=e.slice(0,r);if(a)for(c=i(c);!c.length&&n.length;){const e=n.pop();c=i(e||"")}n.push(c)}else{let o=0,i=t.length-1;for(;o<=i;){const e=Math.floor((o+i)/2),n=t.slice(0,e+1).join(" ");O(n)<=b?o=e+1:i=e-1}if(0===o){e=s-1;continue}c=t.slice(0,o).join(" "),r[0].splice(0,o),n.push(c)}}return T(o),n};return s>0?e().map(j):c}),[c,T,s,j,b,a]);return e.createElement("span",Object.assign({},d,{ref:m}),e.createElement("span",null,x),e.createElement("span",{ref:h},c),e.createElement("span",{ref:v,style:{position:"fixed",visibility:"hidden",top:0,left:0}},u))};export{l as default};
//# sourceMappingURL=index.js.map
